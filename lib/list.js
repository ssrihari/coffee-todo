// Generated by CoffeeScript 1.3.3
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  this.List = (function() {

    List.COUNT = 0;

    function List(board_id, id, name) {
      this["delete"] = __bind(this["delete"], this);

      this.fetchItems = __bind(this.fetchItems, this);

      this.save = __bind(this.save, this);

      this.content = __bind(this.content, this);

      this.addItem = __bind(this.addItem, this);

      this.setUpView = __bind(this.setUpView, this);
      List.COUNT++;
      this.board_id = board_id;
      this.items = [];
      this.input = $('<input type="text"/>');
      this.input.keyup(this.save);
      this.id = ((id != null) ? id : List.COUNT);
      if ((name != null)) {
        this.input.val(name);
      } else {
        this.input.val("List");
      }
      this.input.attr('id', "list-" + this.id + "-name");
      this.view = this.setUpView();
      $("#board-" + this.board_id).append(this.view);
      this.save();
    }

    List.prototype.setUpView = function() {
      var addItemDiv, listContainer, listDeleteDiv, listItemsDiv, listNameDiv;
      listContainer = $('<div class="list-container"></div>');
      listDeleteDiv = $('<div class="list-delete"><p>x</p></div>');
      listDeleteDiv.click(this["delete"]);
      listNameDiv = $('<div class="list-name"></div>');
      listNameDiv.append(this.input);
      listItemsDiv = $('<div class="list-items"></div>');
      listItemsDiv.attr('id', "list-" + this.id + "-items");
      addItemDiv = $('<div class="add-item">+</div>');
      addItemDiv.click(this.addItem);
      listContainer.append(listDeleteDiv);
      listContainer.append(listNameDiv);
      listContainer.append(listItemsDiv);
      listContainer.append(addItemDiv);
      return listContainer;
    };

    List.prototype.addItem = function() {
      console.log(this.id);
      return this.items.push(new Item(this.id));
    };

    List.prototype.content = function() {
      return this.input.val();
    };

    List.prototype.save = function() {
      var listName;
      listName = this.content();
      return $.post("list.php", {
        'name': listName,
        'id': this.id,
        'board_id': this.board_id
      }, function(data) {
        return console.log("List save data: " + data);
      });
    };

    List.prototype.fetchItems = function() {
      var _this = this;
      return $.get("item.php", {
        list_id: this.id
      }, function(data) {
        var i, item, _results;
        data = JSON.parse(data);
        _results = [];
        for (i in data) {
          item = data[i];
          _results.push(_this.items.push(new Item(_this.id, item['id'], item['data'])));
        }
        return _results;
      });
    };

    List.prototype["delete"] = function() {
      if (!confirm("Are you sure?")) {
        return;
      }
      this.view.remove();
      return $.post("list.php", {
        'delete': true,
        'id': this.id
      }, function(data) {
        return console.log("List save data: " + data);
      });
    };

    return List;

  })();

}).call(this);
